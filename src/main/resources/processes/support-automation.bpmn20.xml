<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:flowable="http://flowable.org/bpmn"
             xsi:schemaLocation="
               http://www.omg.org/spec/BPMN/20100524/MODEL
               http://www.omg.org/spec/BPMN/20100524/BPMN20.xsd"
             targetNamespace="SupportAI">

    <process id="supportAutomation" name="Support Automation" isExecutable="true">

        <startEvent id="start"/>

        <serviceTask id="classifyTicket" name="Classify Ticket" flowable:class="org.example.support.workflow.delegate.ClassifyTicketDelegate" />

        <exclusiveGateway id="priorityGateway"/>

        <serviceTask id="generateReply"
                     name="Generate AI Reply"
                     flowable:class="org.example.support.workflow.delegate.GenerateReplyDelegate"/>

        <userTask id="humanReview" name="Human Review Required"/>

        <endEvent id="end"/>

        <sequenceFlow sourceRef="start" targetRef="classifyTicket"/>
        <sequenceFlow sourceRef="classifyTicket" targetRef="priorityGateway"/>

        <sequenceFlow sourceRef="priorityGateway" targetRef="generateReply">
        <conditionExpression xsi:type="tFormalExpression"><![CDATA[${confidence >= 0.8}]]></conditionExpression>
        </sequenceFlow>

        <sequenceFlow sourceRef="priorityGateway" targetRef="humanReview">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${confidence < 0.8}]]></conditionExpression>
        </sequenceFlow>

        <sequenceFlow sourceRef="generateReply" targetRef="end"/>
        <sequenceFlow sourceRef="humanReview" targetRef="end"/>

    </process>
</definitions>
